package lol.nebula.module.exploit;

import lol.nebula.listener.bus.Listener;
import lol.nebula.listener.events.entity.move.EventPushOutOfBlocks;
import lol.nebula.listener.events.entity.move.EventWalkingUpdate;
import lol.nebula.module.Module;
import lol.nebula.module.ModuleCategory;
import lol.nebula.setting.Setting;
import net.minecraft.network.play.client.C03PacketPlayer.C04PacketPlayerPosition;

/**
 * @author aesthetical
 * @since 05/27/23
 */
public class Phase extends Module {

    private final Setting<Mode> mode = new Setting<>(Mode.NO_CLIP, "Mode");
    //private final Setting<AntiCheat> antiCheat = new Setting<>(AntiCheat.VANILLA, "Anti-Cheat");

    public Phase() {
        super("Phase", "Phases into or through blocks", ModuleCategory.EXPLOIT);
    }

    @Override
    public void onDisable() {
        super.onDisable();

        if (mc.thePlayer != null) mc.thePlayer.noClip = false;
    }

    @Listener
    public void onWalkingUpdate(EventWalkingUpdate event) {
        if (!mc.thePlayer.isCollidedHorizontally) return;

        switch (mode.getValue()) {
            case NO_CLIP:
                mc.thePlayer.noClip = true;
                break;

            case SAND:
                float yaw = mc.thePlayer.rotationYaw * 0.017453292f;

                double factor = 0.00624;
                double x = mc.thePlayer.posX + (-Math.sin(yaw) * factor);
                double z = mc.thePlayer.posZ + (Math.cos(yaw) * factor);

                event.cancel();

                mc.thePlayer.sendQueue.addToSendQueue(new C04PacketPlayerPosition(x,
                        mc.thePlayer.boundingBox.minY, mc.thePlayer.posY, z, true));

                mc.thePlayer.setPosition(x, mc.thePlayer.posY, z);
                break;

            case WALL:
                break;

            case DOOR:
                break;
        }
    }

    @Listener
    public void onPushOutOfBlocks(EventPushOutOfBlocks event) {
        if (event.getEntity() != null
                && event.getEntity().equals(mc.thePlayer)) event.cancel();
    }

    public enum AntiCheat {
        VANILLA, NCP
    }

    public enum Mode {
        NO_CLIP, SAND, DOOR, WALL
    }
}
