package lol.nebula.module.exploit;

import lol.nebula.listener.bus.Listener;
import lol.nebula.listener.events.net.EventPacket;
import lol.nebula.listener.events.render.gui.EventDisplayGui;
import lol.nebula.module.Module;
import lol.nebula.module.ModuleCategory;
import net.minecraft.client.gui.inventory.GuiChest;
import net.minecraft.client.gui.inventory.GuiContainer;
import net.minecraft.network.play.client.C0DPacketCloseWindow;
import net.minecraft.network.play.server.S2EPacketCloseWindow;

/**
 * @author aesthetical
 * @since 05/31/23
 */
public class ChestBackpack extends Module {

    private GuiContainer guiChest;

    public ChestBackpack() {
        super("Chest Backpack",
                "Keeps chest containers \"open\" and reopens it when you need it",
                ModuleCategory.EXPLOIT);
    }

    @Override
    public void onDisable() {
        super.onDisable();

        if (guiChest != null) mc.displayGuiScreen(guiChest);
        guiChest = null;
    }

    @Listener
    public void onDisplayGui(EventDisplayGui event) {
        if (event.getDisplayed() instanceof GuiChest && guiChest == null) {
            guiChest = (GuiContainer) event.getDisplayed();
            print("Disable this module when you want to open back up the container");
        }
    }

    @Listener
    public void onPacketOutbound(EventPacket.Outbound event) {
        if (event.getPacket() instanceof C0DPacketCloseWindow) event.cancel();
    }

    @Listener
    public void onPacketInbound(EventPacket.Inbound event) {
        if (event.getPacket() instanceof S2EPacketCloseWindow && guiChest != null) {
            event.cancel();
            mc.displayGuiScreen(guiChest);
            guiChest = null;
        }
    }
}
