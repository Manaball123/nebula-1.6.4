package lol.nebula.module.exploit;

import lol.nebula.listener.bus.Listener;
import lol.nebula.listener.events.entity.EventUpdate;
import lol.nebula.module.Module;
import lol.nebula.module.ModuleCategory;
import lol.nebula.setting.Setting;
import net.minecraft.item.ItemBow;
import net.minecraft.item.ItemFood;
import net.minecraft.item.ItemPotion;
import net.minecraft.item.ItemStack;
import net.minecraft.network.play.client.C03PacketPlayer;

/**
 * @author aesthetical
 * @since 04/29/23
 */
public class FastUse extends Module {

    private final Setting<Integer> useTicks = new Setting<>(3, 0, 20, "Use Ticks");
    private final Setting<Boolean> bow = new Setting<>(true, "Bows");
    private final Setting<Boolean> food = new Setting<>(true, "Food");
    private final Setting<Boolean> potion = new Setting<>(true, "Potions");

    public FastUse() {
        super("Fast Use", "Uses items faster by sending many C03s", ModuleCategory.EXPLOIT);
    }

    @Listener
    public void onUpdate(EventUpdate event) {
        ItemStack stack = mc.thePlayer.getItemInUse();
        if (stack == null || stack.getItem() == null) return;

        // if the use count is less than the minimum use ticks, don't continue
        int useCount = mc.thePlayer.getItemInUseDuration();
        if (useCount < useTicks.getValue()) return;

        if ((stack.getItem() instanceof ItemFood && food.getValue())
                || (stack.getItem() instanceof ItemPotion && potion.getValue())
                || (stack.getItem() instanceof ItemBow && bow.getValue())) {

            for (int i = 0; i < 21 - useCount; ++i) {
                mc.thePlayer.sendQueue.addToSendQueue(new C03PacketPlayer());
            }

            if (stack.getItem() instanceof ItemBow) mc.thePlayer.stopUsingItem();
        }
    }
}
